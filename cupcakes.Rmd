---
title: "Analysis of Baking Powder Brand on Cupcake Rise"
subtitle: "STAT 461 Final Project"
author: "Rimjhim Mitra, James Myers, Jackson Charles Pieretti, Ted Tasman"
date: "12/19/2025"
output: 
  pdf_document:
    latex_engine: xelatex
geometry: left=1in,right=1in,top=1in,bottom=1in
urlcolor: blue
header-includes:
  - \usepackage{subfig}
---

```{r setupFiles, include = FALSE}
# Setting Document Options ----
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.align = "center"
)

# Import Packages
packages <- c("tidyverse", "knitr", "kableExtra", "psych", "car",
              "mratios", "permute", "emmeans", "hasseDiagram"
)
lapply(
  X = packages,
  FUN = library,
  character.only = TRUE
)

# Set Options
options(contrasts = c("contr.sum", "contr.poly"))
options(knitr.kable.NA = "")

# Load data
rawCupcakes <- read.table(
  file = "https://raw.github.com/tedtasman/STAT-461-Course-Project/refs/heads/main/cupcakes.dat",
  header = TRUE
)

# Convert to dataframe
cupcakes <- as.data.frame(rawCupcakes)

# Drop None
cupcakes <- cupcakes[cupcakes$brand != "none", ]

# Factor design
cupcakes$position <- as.factor(cupcakes$position)
cupcakes$brand <- factor(
  cupcakes$brand,
  labels = c(
    "Clabber Girl",
    "Rumford",
    "Wegman's"
  )
)





# Define Freedman-Diaconis Rule
fdRule <- function(x) {
  return(
    ifelse(
      test = IQR(x) == 0,
      yes =  0.1,
      no =  2 * IQR(x) / (length(x)^(1/3))
    )
  )
}

```

# Literature Review

# Methodology


```{r hasseDiagram}
#| fig.cap="Hasse Diagram of Paper Airplanes Study",
#| out.height="25%"

# Generate Hasse Diagram ========

```


# Data Exploration

```{r boxplot}
#| fig.cap="Box plots of Post Bake Height by Baking Powder Brand",
#| out.width="60%"
# Box plots of plane designs ========
ggplot(
  data = cupcakes,
  mapping = aes(x = baked, y = brand, fill = brand)
) +
  geom_boxplot() +
  theme_bw() +
  xlab("Cupcake Height (mm)") +
  ylab(NULL) +
  theme(
    legend.position = "none",
    text = element_text(size = 12)
  )
```

**INTERPRET BOXPLOT** Figure \ref{fig:boxplot}

```{r histograms}
#| fig.cap="Histograms of Post Bake Height by Baking Powder Brand",
#| fig.width=6,
#| fig.height=4,
#| fig.pos="H"
# Create histograms by design ========
ggplot(
  data = cupcakes,
  mapping = aes(x = baked, fill = brand)
) +
  geom_histogram(
    binwidth = fdRule,
    col = "black",
    closed = "left",
    boundary = 0
  ) +
  scale_y_continuous(
    expand = expansion(mult = 0, add = c(0, 1))
  ) +
  facet_wrap(
    facets = ~brand,
    scales = "free_x"
  ) +
  theme_bw() +
  xlab("Cupcake Height (mm)") +
  ylab("Frequency") +
  theme(
    text = element_text(size = 12),
    legend.position = "none"
  )

```

**INTERPRET HISTOGRAMS Figure \ref{fig:histograms}**

```{r descStats}
# Get descriptive statistics by design ========
groupStats <- psych::describeBy(
  x = cupcakes$baked,
  group = cupcakes$brand,
  na.rm = TRUE,
  skew = TRUE,
  ranges = TRUE,
  quant = c(0.25, 0.75),
  IQR = TRUE,
  mat = TRUE,
  digits = 4
)

# Clean
groupStats <- groupStats %>%
  tibble::remove_rownames() %>%
  tibble::column_to_rownames(
    var = "group1"
  ) %>%
  dplyr::select(
    n, min, Q0.25, median, Q0.75, max, mad, mean, sd, skew, kurtosis
  )

```


```{r descStatsTable1}
# Generate table for first 6 stats ========
groupStats[1:6] %>%
  knitr::kable(
    caption = "Quantile Statistics for Cupcake Heights",
    digits = 3,
    format.args = list(big.mark = ","),
    align = rep('c', 6),
    col.names = c("n", "Min", "Q1", "Median", "Q3", "Max"),
    booktabs = TRUE
  )  %>%
  kableExtra::kable_styling(
    latex_options = c("scale_down")
  ) 
```

**INTERPRET STATISTICS Table \ref{tab:descStatsTable1}**

```{r descStatsTable2}
# Generate table for rest of stats ========
groupStats[7:11] %>%
  knitr::kable(
    caption = "Summary Statistics for Cupcake Heights",
    digits = 3,
    format.args = list(big.mark = ","),
    align = rep('c', 5),
    col.names = c("MAD", "SAM", "SASD","Sample Skew", "Sample Ex. Kurtosis"),
    booktabs = TRUE
  )  %>%
  kableExtra::kable_styling(
    latex_options = c("scale_down")
  ) 
```

**INTERPRET STATISTICS Table \ref{tab:descStatsTable2}**

# Results

**INTERPRET HYPOTHESES**:


```{r model}
# Fit the model ========
cupcakeModel <- aov(
  formula = baked ~ initial + brand,
  data = cupcakes,
  na.action = "na.omit"
)
```

## Assumptions

```{r linearity}
# Demo Code for Assessing Homogeneity of Slopes in Keyboarding Pain Study ----
cupcakeModel <- aov(
  formula = baked ~ position + initial + brand + initial:brand,
  data = cupcakes
)

# Scatter plot of hours of pain and hours spent keyboarding ----
# 
ggplot(
  data = cupcakes,
  mapping = aes(
    y = baked,
    x = initial
  )
) +
  geom_point(size = 2) +
  geom_smooth(
    method = "lm",
    formula = y ~ x,
    color = "black",
    linetype = "dashed",
    se = FALSE
  ) +
  theme_bw() +
  labs(
    x = "Initial Batter Height (mm)",
    y = "Cupcake Height After Baking (mm)"
  )
```
Interpret Figure \ref{fig:linearity}, note that lack of linearity is caused by dramatic differences in factor effects

```{r slopes}
ggplot(
  data = cupcakes,
  mapping = aes(
    y = baked,
    x = initial,
    color = brand,
    shape = brand,
    linetype = brand
  )
) +
  geom_point(size = 2) +
  geom_smooth(
    method = "lm",
    mapping = aes(y = predict(cupcakeModel)),
    formula = y ~ x,
    se = FALSE
  ) +
  theme_bw() +
  labs(
    x = "Initial Batter Height (mm)",
    y = "Cupcake Height After Baking (mm)",
    color = "Brand",
    shape = "Brand",
    linetype = "Brand"
  ) +
   theme(
     legend.position = "right",
     legend.key.width = unit(1, "cm")
   )
```
Interpet Figure \ref{fig:slopes}

```{r outliers}
# Outlier detection
ggplot(
  data = cupcakes,
  mapping = aes(x = baked)
) + 
  geom_boxplot(
    coef = 1.5
  ) +
  theme_void() + 
  xlab("Hours of Pain") +
  theme(
    axis.line.x = element_line(),
    axis.text.x = element_text(size = 12),
    axis.title.x = element_text(size = 12)
  )

```


```{r qqPlot}
#| fig.cap="QQ Plot for Distance Flown Residuals",
#| out.width="80%"
## Create the QQ plot ========
car::qqPlot(
  x = planeModel$residuals,
  distribution = "norm",
  envelope = 0.9,
  id = FALSE,
  pch = 20,
  ylab = "Residuals (in)",
  xlab = "Gaussian Quantiles"
)

# Calculate overall sample skew and excess kurtosis
sskew <- psych::skew(planeModel$residuals)
skurt <- psych::kurtosi(planeModel$residuals)
```

Interpet Figure \ref{fig:qqPlot}

```{r homoscedasticity}
#| fig.cap="Strip Chart for Distance Flown Residuals",
#| out.width="70%"
# Create strip chart ========
ggplot(
  data = data.frame(
    residuals = planeModel$residuals,
    fitted = planeModel$fitted.values
  ),
  mapping = aes(x = fitted, y = residuals)
) +
  geom_point(size = 2) +
  theme_bw() +
  labs(
    x = "Fitted values (in)",
    y = "Residuals (in)"
  )
```

Interpret Figure \ref{fig:homoscedasticity}

```{r indexPlot}
#| fig.cap="Index Plot for Distance Flown Residuals",
#| out.width="70%"
# Create the Index Plot ========
ggplot(
  data = data.frame(
    residuals = planeModel$residuals,
    index = planes$order
  ),
  mapping = aes(x = index, y = residuals)
) +
  geom_point(size = 1.5) +
  geom_line() +
  theme_bw() +
  geom_hline(
    yintercept = 0,
    linetype = "dashed",
    color = "red"
  ) +
  labs(
    x = "Measurement order",
    y = "Residuals (lbs)"
  )

planesDW <- car::durbinWatsonTest(planeModel)$dw
```

Interpret \ref{fig:indexPlot}



## Parametric Shortcut: F-Ratio Test

```{r anovaTable}
# Create a professional looking ANOVA table ========
parameters::model_parameters(
  model = planeModel,
  es_type = c("eta", "omega", "epsilon") 
) %>%
  knitr::kable(
  digits = 4,
  col.names = c(
    "Source", "SS", "df", "MS", "F", "p-value",
    "Eta Sq.", "Omega Sq.", "Epsilon Sq."),
  caption = "ANOVA Table for Paper Plane Flight Distance",
  booktabs = TRUE, 
  align = c("l", rep("c", 8)),
  # format = "latex"
  ) %>%
  kableExtra::kable_styling(
    font_size = 12,
    latex_options = c("HOLD_position")
  )

# Get S-value
pValue <- summary(planeModel)[[1]][["Pr(>F)"]][1]
sValue <- -1*log(pValue, base = 2)
```

Interpret \ref{tab:anovaTable}

## Effect Sizes

```{r pointEst}
# Perform point estimation ========
pointEst <- dummy.coef(planeModel)
pointEst <- unlist(pointEst)
names(pointEst) <- c("Grand Mean", "Basic", "V-Wing",
                     "Dart")

data.frame("Estimate" = pointEst) %>%
  knitr::kable(
  digits = 2,
  caption = "Point Estimates from Paper Plane Distances",
  booktabs = TRUE,
  align = "c"
  ) %>%
  kableExtra::kable_styling(
    font_size = 12,
    latex_options = c("HOLD_position")
  ) 
```
**INTERPRET POINT ESTIMATES Table \ref{tab:pointEst}**


```{r confInt}
# Calculate Point and Interval Estimates for Marginal Means ========
planeMeans <- emmeans(
  object = planeModel,
  specs = ~ design,
  level = 0.88,
  adjust = "tukey"
) 

planeMeans <- as.data.frame(planeMeans)
planeMeans %>%
  kable(
    digits = 4,
    caption = "Marginal Mean Estimates from Paper Plane Distances",
    col.names = c("Distance Flown (in.)", "Marginal Mean", "SE", "df",
                  "Lower Bound", "Upper Bound"),
    booktabs = TRUE,
    align = "c"
  ) %>%
  kableExtra::kable_styling(
    font_size = 12,
    latex_options = c("HOLD_position")
  ) 
```
**INTERPERET CONFIDENCE INTERVALS Table \ref{tab:confInt}**

## Pairwise Comparisons
```{r tukeyHSD}
# Perform Tukey HSD ========
planeHSD <- TukeyHSD(
  x = planeModel,
  conf.level = 0.88
)

# Make professional table
## Tukey HSD
as.data.frame(planeHSD$design) %>%
  tibble::rownames_to_column(var = "Pair") %>%
  knitr::kable(
    digits = 3,
    caption = "Post Hoc Tukey HSD Comparisons",
    col.names = c("Pair", "Difference", "Lower Bound",
                  "Upper Bound", "Adj. p-Value"),
    align = 'lcccc',
    booktabs = TRUE,
  ) %>%
  kableExtra::kable_styling(
    bootstrap_options = c("condensed", "boardered"),
    font_size = 12,
    latex_options = c("HOLD_position")
  )
```

```{r connectingLetters}
#| fig.cap="Box plots of Distance Flown by Design",
#| out.width="60%"
# Create connecting letters boxplot ========
# Ensure planes is a dataframe
planesFrame <- as.data.frame(planes)
# Remove the dash from V-Wing
levels(planesFrame$design)[levels(planesFrame$design) == "V-Wing"] <- "V Wing"

# Create boxplot
multcompView::multcompBoxplot(
  formula = distance_in ~ design,
  data = planesFrame,
  compFn = "TukeyHSD",
  plotList = list(
    boxplot = list(fig = c(0, 0.85, 0, 1)),
    multcompLetters = list(
      fig = c(0.8, 0.9, 0.1, 0.9),
      fontsize = 12,
      fontface = "bold"
    )
  )
)
```

**INTERPET CONNECTING LETTERS BOXLPLOT Figure \ref{fig:connectingLetters}**

# Discussion

\newpage

# References

\newpage

# Code Appendix

```{r codeAppendix}
#| ref.label = knitr::all_labels(),
#| echo = TRUE,
#| eval = FALSE

```















